<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="始于技术 终于生活"><title>限频节流函数debounce&amp;throttle | Aszero</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '05229ec683dcdbf3f2336800f1e4a337';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
  </script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">限频节流函数debounce&amp;throttle</h1><a id="logo" href="/."><span class="defualt">As</span><span class="vi-color">zero</span></a><p class="description">原谅走过的那些曲折，原来留下的都是真的</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">限频节流函数debounce&amp;throttle</h1><div class="post-meta">Dec 1, 2018<span> | </span><span class="category"><a href="/categories/js/">js</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#场景一-曝光埋点"><span class="toc-number">1.</span> <span class="toc-text">场景一 曝光埋点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#场景二-表单合法性即时检查"><span class="toc-number">2.</span> <span class="toc-text">场景二 表单合法性即时检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#throttle-amp-debounce"><span class="toc-number">3.</span> <span class="toc-text">throttle &amp; debounce</span></a></li></ol></div></div><div class="post-content"><p><code>lodash</code>的function模块里有两个方法，<code>debounce</code> 和 <code>throttle</code>，可以做节流限频使用，为在某些特定的环境下做必要的优化。<br>这两个方法了解原理后也可以自己去实现。</p>
<h3 id="场景一-曝光埋点"><a href="#场景一-曝光埋点" class="headerlink" title="场景一 曝光埋点"></a>场景一 曝光埋点</h3><p>在一个多屏长度的页面中，A模块的A元素在出现在屏幕可视区域时候（即曝光）触发埋点事件，随即上报相应参数。<br>思路：A模块A元素距离文档顶部的高度是固定值设为<code>bodyOffsetTop</code>，添加onscroll事件到window上，通过监听滚动事件，不断计算此时被卷入上去的文档高度<code>docScrollTop</code>,假设屏幕可视区域的高度为<code>viewHeight</code>。<br>当以下条件成立的时候，我们就认为该元素是出于可曝光的区域的。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bodyOffsetTop &lt;= docScrollTop + viewHeight</span><br></pre></td></tr></table></figure><br>具体实现代码：<br><a id="more"></a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//递归方式获得元素距离文档顶部真实高度，不受父元素position定位影响</span></span><br><span class="line"><span class="keyword">const</span> bodyOffsetTop = <span class="function">(<span class="params">el</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(el.offsetParent.nodeName.toLowerCase() === <span class="string">'body'</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> el.offsetTop</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> el.offsetTop + bodyTopOffsetTop(el.offsetParent)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> verticalExpoEvent = <span class="function">(<span class="params">el,callback</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( el &amp;&amp; el.className.indexOf(<span class="string">'hasExpoed'</span>) &gt; <span class="number">-1</span> || !el) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">const</span> srcollyTop = <span class="built_in">document</span>.body.scrollTop || <span class="built_in">document</span>.documentElement.scrollTop</span><br><span class="line">  <span class="keyword">const</span> viewHeight = <span class="built_in">document</span>.body.clientHeight</span><br><span class="line">  <span class="keyword">const</span> elBodyOffsetTop = bodyOffsetTop(el)</span><br><span class="line">  <span class="keyword">const</span> expoHeight =  srcollyTop + viewHeight</span><br><span class="line">  <span class="keyword">if</span>(expoHeight &gt;= elBodyOffsetTop)&#123;</span><br><span class="line">    el.className = el.className + <span class="string">' hasExpoed'</span> <span class="comment">//增加曝光后不再曝光标识</span></span><br><span class="line">    callback &amp;&amp; callback()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'scroll'</span>,verticalExpoEvent)</span><br></pre></td></tr></table></figure></p>
<p>以上代码可以实现功能，拿出去用看似也没有什么问题，毕竟现在的机器的都很高级嘛，处理器内存什么的依然可以有丝滑般体验。<br>但是，作为一个有追求的严谨的coding工程师,不仅要code的出来功能还要在乎功能的高性能高可用高维护，职业素养必修课之一啊。<br>上面的代码可以实现我们想要的功能，但是window的<code>onscroll</code>事件的监听是需要非常谨慎使用的，因为以像素为单位，以你滚动速度维度，以你一秒滚动一百个像素的来计算，机器需要一秒执行你的onscroll回调函数一百次，其中的计算量大多数都是无效的，非<code>pay-load</code>，以至于不怎么高端的机器，吃着火锅滑着屏幕的时候手机就死机了。<br>这时候就需要在有效时候做<code>节流</code><br><em>解决思路：</em> 无论以什么做触发单位，滑动速度有多快，都以固定的频率去执行监听事件。</p>
<h3 id="场景二-表单合法性即时检查"><a href="#场景二-表单合法性即时检查" class="headerlink" title="场景二 表单合法性即时检查"></a>场景二 表单合法性即时检查</h3><p>用户在填写表单输入时候，需要即时的对用户的输入合法性进行检测,如敏感词等<br>思路： </p>
<ul>
<li>使用<code>onchange</code>或者<code>onkeyup</code>做监听</li>
<li>限制监听<code>keyCode</code>范围</li>
<li>剪切和黏贴事件会change表单值</li>
<li>中文输入法处理</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// between func</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">let</span> enLock = <span class="literal">false</span></span><br><span class="line"><span class="keyword">const</span> between = <span class="function">(<span class="params">val, x, y</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> val !== <span class="string">'number'</span> || <span class="keyword">typeof</span> x !== <span class="string">'number'</span> || <span class="keyword">typeof</span> y !== <span class="string">'number'</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Each agru should be a number'</span>)</span><br><span class="line">  <span class="keyword">return</span> (val &gt;= x &amp;&amp; val &lt;= y)</span><br><span class="line">&#125;</span><br><span class="line">$el.addEventListener(<span class="string">'keyup'</span>,(e)=&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(enLock) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">if</span>( between(e.keyCode, <span class="number">48</span>, <span class="number">57</span>) || between(e.keyCode, <span class="number">65</span>, <span class="number">90</span>))&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e.target.value)</span><br><span class="line">    <span class="comment">// 合法性检查 ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">$el.addEventListener(<span class="string">'cut'</span>,(e)=&gt;&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">truetrue<span class="built_in">console</span>.log(e.target.value)</span><br><span class="line">    <span class="comment">// 合法性检查 ...</span></span><br><span class="line">true&#125;,<span class="number">0</span>)</span><br><span class="line">&#125;)</span><br><span class="line">$el.addEventListener(<span class="string">'paste'</span>,(e)=&gt;&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">truetrue<span class="built_in">console</span>.log(e.target.value)</span><br><span class="line">    <span class="comment">// 合法性检查 ...</span></span><br><span class="line">true&#125;,<span class="number">0</span>)</span><br><span class="line">&#125;)</span><br><span class="line">$el.addEventListener(<span class="string">'compositionstart'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    enLock = <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line">$el.addEventListener(<span class="string">'compositionend'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    enLock = <span class="literal">false</span></span><br><span class="line">    <span class="built_in">console</span>.log(e.target.value)</span><br><span class="line">    <span class="comment">// 合法性检查 ...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<p>以上代码也可以实现功能，但还是有问题，用户在进行输入的时候，每个字符汉字都需要进行整篇的合法性检查，违背了高效性，浪费了一定的资源，我们其实只需要在用户停止输入的短时间内或者离开表单时候进行合法性检查即可。<br><em>解决思路：</em> 用户输入间隔期间或者离开之前进行检测。</p>
<h3 id="throttle-amp-debounce"><a href="#throttle-amp-debounce" class="headerlink" title="throttle &amp; debounce"></a>throttle &amp; debounce</h3><p><a href="https://www.lodashjs.com/docs/4.17.5.html#debounce" target="_blank" rel="noopener">debounce</a>  限频<br>简单理解：在限定的时间内如果有新触发，那么上一次的触发无效，限时重新计算。限定的时间无触发或者大于限定的时间触发，都会按照正常触发执行。</p>
<p><a href="https://www.lodashjs.com/docs/4.17.5.html#throttle" target="_blank" rel="noopener">throttle</a>  节流<br>简单理解：在限定的时间内如果有新触发，那么函数会按照限定时间间隔执行，直到限定的时间无触发或者大于限定的时间触发。</p>
<p><em>举例子</em><br>有一个button $btn, 绑定click事件callback函数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$btn.addEventListener(<span class="string">'click'</span>, callback)</span><br><span class="line">$btn.addEventListener(<span class="string">'click'</span>, _.debounce(callback,<span class="number">1000</span>,&#123;<span class="attr">leading</span>:<span class="literal">false</span>,<span class="attr">trailing</span>:<span class="literal">true</span>&#125;))</span><br><span class="line">$btn.addEventListener(<span class="string">'click'</span>, _.throttle(callback,<span class="number">1000</span>,&#123;<span class="attr">leading</span>:<span class="literal">true</span>,<span class="attr">trailing</span>:<span class="literal">true</span>&#125;))</span><br></pre></td></tr></table></figure></p>
<p><em>啥都没做</em> 那么你点击的手速多快，这个callback函数就会被执行多少遍。<br><em>debounce</em> 做了1秒的限频，无限快的手速点击$btn，10秒后callback被执行 <em>0</em> 次，11秒后callback被执行1次<br><em>throttle</em> 做了1秒的限频，无限快的手速点击$btn，10秒后callback被执行 <em>10</em> 次</p>
<p>但是如果你是…<br><img src="flash.jpg" width="200" style="border-radius:50%"><br><a href="https://baike.baidu.com/item/%E9%97%AA%E7%94%B5/19463688?fr=aladdin" target="_blank" rel="noopener">闪电</a>点击的间隔超过1秒，那么这两个限制函数对你无效。</p>
<p>以上场景一和场景二的代码可优化为如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 曝光埋点</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'scroll'</span>,_.throttle(verticalExpoEvent,<span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 表单合法性即时检查</span></span><br><span class="line">$el.addEventListener(<span class="string">'keyup'</span>,_.debounce(<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(enLock) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">if</span>( between(e.keyCode, <span class="number">48</span>, <span class="number">57</span>) || between(e.keyCode, <span class="number">65</span>, <span class="number">90</span>))&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e.target.value)</span><br><span class="line">    <span class="comment">// 合法性检查 ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,<span class="number">500</span>))</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>原创内容，欢迎交流转载请注明出处</p>
</blockquote>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>zhangxiao</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2018/12/01/限频节流函数debounce-throttle/">http://aszero.com/2018/12/01/限频节流函数debounce-throttle/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>aszero</li></ul></div><br><div class="tags"><a href="/tags/debounce/">debounce</a><a href="/tags/throttle/">throttle</a></div><div class="post-nav"><a class="pre" href="/2018/12/29/前端利用js进行图片压缩/">前端利用js进行图片压缩</a><a class="next" href="/2018/11/23/vue-vuex/">Vue长笔陆续更新</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget widget-info"><div class="widget-info"><a style="text-align:center"><img class="widget-info-photo" src="https://img20.360buyimg.com/ee/jfs/t27454/222/2096395420/282307/5767f3e1/5bf6c424N9b90570a.jpg" style="width:80px;height:80px;border-radius: 100%;"></a><p class="myname">厂长大人</p><p class="slogan">Zero to Hero</p></div></div><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/11/06/TS笔记整理-2-高级类型/">TS笔记整理(2)-高级类型</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/06/京东上海秋招部门笔试题/">【京东上海】部门前端秋招部分笔试题</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/31/浏览器标签之间通信的几种方式/">浏览器标签之间通信的几种方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/31/同步异步和阻塞非阻塞概念/">同步异步和阻塞非阻塞概念</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/14/基于RESTful风格的查询api-接口文档/">基于REST风格的查询api的构思设计</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/12/垂直横向曝光事件的发生/">垂直横向曝光事件的发生</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/15/移动开发中视觉稿和设备之间单位自适应转化/">移动端开发之尺寸自适应解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/03/搭建开发脚手架CLI/">搭建开发脚手架CLI</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/15/dotjs-webpack分模块拼接渲染/">dotjs+webpack分模块拼接渲染</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/27/TS笔记整理/">TS笔记整理(1)-类型</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/dotjs/">dotjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/h5/">h5</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tool/">tool</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ts/">ts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/webpack/">webpack</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/windows/">windows</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/joacycode" title="github.com/joacycode" target="_blank">github.com/joacycode</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Aszero.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>